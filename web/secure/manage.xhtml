<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:p="http://primefaces.org/ui">
    <h:head>
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
        <meta http-equiv="Pragma" content="no-cache"/>
        <meta http-equiv="Cache-Control" content="no-cache"/>
        <meta http-equiv="Expires" content="0"/>
        <title>管理</title>
        <h:outputScript library="primefaces" name="jquery/jquery.js" />
        <script src="../resources/js/locUpload.js"></script>
        <script type="text/javascript">
            //<![CDATA[
            function postMacAddrLog(msg) {
                $.ajax({
                    type: 'POST',
                    contentType: 'application/json',
                    url: '#{myParam.upLogUrl}',
                    dataType: 'json',
                    data: JSON.stringify({'message':msg})
                });
            }
            function setLocalStorage(key, value) {
                if (value.trim() === '') {
                    alert('0から9の数字および、AからFまでの文字(12桁)で入力してください。');
                    return;
                }
                if (!(12 === value.length)) {
                    alert('0から9の数字および、AからFまでの文字(12桁)で入力してください。');
                    return;
                }
                if (value.match(/[^0-9A-F]+/)) {
                    alert('0から9の数字および、AからFまでの文字(12桁)で入力してください。');
                    return;
                }
                if(window.confirm('登録しますか？')){
                    localStorage.setItem(key, value);
                    postMacAddrLog('R,' + value);
                    var msg = '登録しました';
                    alert(msg);
                } else {
                    
                }
            }
            function removeLocalStorage(key) {
                var maddr = localStorage.getItem('MACADDR');
                if (maddr !== null) {
                    if(window.confirm('削除しますか？')){
                        localStorage.removeItem(key);
                        postMacAddrLog('D,'+maddr);
                    }
                }
            }
            $(document).ready(function() {
                var nowMacAddr = document.getElementById('form:nowMacAddr');
                var maddr = localStorage.getItem('MACADDR');
                if (maddr === null) {
                    if ('#{adjustModels.model}' === 'android') {
                        var aa = window.#{adjustModels.external}.getMacAddr();
                        maddr = aa + '(物理)';
                    } else {
                        maddr = '登録されていません';
                    }
                }
                nowMacAddr.innerHTML = maddr;
            });
            //]]>
        </script>
    </h:head>
    <h:body>
        管理用画面
        <br /><br />
        <h:form id="form" onkeypress="if (event.keyCode === 13) { return false; }">
            <h:panelGrid columns="3" style="font-size:17px;position:relative;top:0px;">
                <h:outputText value="登録済MACアドレス" style="position:relative;top:1px;"/>
                <h:outputText id="nowMacAddr" style="position:relative;top:1px;"/>
                <p:commandButton value="削除" ajax="false" onclick="removeLocalStorage('MACADDR');"/>
                <h:outputText value="新規MACアドレス" style="position:relative;top:1px;"/>
                <p:inputText id="macAddr" maxlength="12"/>
                <p:commandButton value="登録" ajax="false"
                    onclick="setLocalStorage('MACADDR', $('#form\\:macAddr').val());"/>
            </h:panelGrid>
            <br /><br />
            <p:commandButton id="logOut" style="margin-top:50px;font-size:#{adjustModels.fontSize}px;"
                              value="#{myMsg.logout}"
                              action="#{sessionManager.logOut()}"
                              icon="ui-icon-circle-close" oncomplete="logOut()">
            </p:commandButton>
        </h:form>
    </h:body>
</html>